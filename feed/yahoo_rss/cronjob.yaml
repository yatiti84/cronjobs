---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: ksa-feed
  namespace: cron
---
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: feed-yahoo-rss
  namespace: cron
spec:
  schedule: "*/30 * * * *"
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 1
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      activeDeadlineSeconds: 300
      template:
        spec:
          serviceAccountName: ksa-feed
          containers:
          - name: mirror-tv-feed-yahoo-rss
            image: gcr.io/mirror-tv-275709/mirror-tv-feed:20201130-2
            workingDir: /feed
            command: [ "./start.sh" ]
            args:
            - $(EXECFOLDER)
            - $(EXECSCRIPT)
            env:
            - name: EXECFOLDER
              value: yahoo_rss
            - name: EXECSCRIPT
              value: generate_yahoo_rss.py
            terminationMessagePath: /dev/termination-log
            terminationMessagePolicy: File
          restartPolicy: OnFailure
